global mode="release"

probe module( "vfat" ).function( "vfat_cmp" ) {
	if ( mode == "debug" ) {
		println( "vfat_cmp" )
	} else {
		if ( mode == "s2e_debug" ) {
			s2e_message( "vfat_cmp" )
		} else {
			@ops_dentry_d_compare( $parent, $dentry, $len, $str, $name )
		}
	}
}

probe module( "vfat" ).function( "vfat_cmpi" ) {
	if ( mode == "debug" ) {
		println( "vfat_cmpi" )
	} else {
		if ( mode == "s2e_debug" ) {
			s2e_message( "vfat_cmpi" )
		} else {
			@ops_dentry_d_compare( $parent, $dentry, $len, $str, $name )
		}
	}
}

probe module( "vfat" ).function( "vfat_create" ) {
	if ( mode == "debug" ) {
		println( "vfat_create" )
	} else {
		if ( mode == "s2e_debug" ) {
			s2e_message( "vfat_create" )
		} else {
			@ops_inode_create( $dir, $dentry, $mode, $excl )
		}
	}
}

probe module( "vfat" ).function( "vfat_hash" ) {
	if ( mode == "debug" ) {
		println( "vfat_hash" )
	} else {
		if ( mode == "s2e_debug" ) {
			s2e_message( "vfat_hash" )
		} else {
			@ops_dentry_d_hash( $dentry, $qstr )
		}
	}
}

probe module( "vfat" ).function( "vfat_hashi" ) {
	if ( mode == "debug" ) {
		println( "vfat_hashi" )
	} else {
		if ( mode == "s2e_debug" ) {
			s2e_message( "vfat_hashi" )
		} else {
			@ops_dentry_d_hash( $dentry, $qstr )
		}
	}
}

probe module( "vfat" ).function( "vfat_lookup" ) {
	if ( mode == "debug" ) {
		println( "vfat_lookup" )
	} else {
		if ( mode == "s2e_debug" ) {
			s2e_message( "vfat_lookup" )
		} else {
			@ops_inode_lookup( $dir, $dentry, $flags )
		}
	}
}

probe module( "vfat" ).function( "vfat_mkdir" ) {
	if ( mode == "debug" ) {
		println( "vfat_mkdir" )
	} else {
		if ( mode == "s2e_debug" ) {
			s2e_message( "vfat_mkdir" )
		} else {
			@ops_inode_mkdir( $dir, $dentry, $mode )
		}
	}
}

probe module( "vfat" ).function( "vfat_rename" ) {
	if ( mode == "debug" ) {
		println( "vfat_rename" )
	} else {
		if ( mode == "s2e_debug" ) {
			s2e_message( "vfat_rename" )
		} else {
			@ops_inode_rename( $old_dir, $old_dentry, $new_dir, $new_dentry )
		}
	}
}

probe module( "vfat" ).function( "vfat_revalidate" ) {
	if ( mode == "debug" ) {
		println( "vfat_revalidate" )
	} else {
		if ( mode == "s2e_debug" ) {
			s2e_message( "vfat_revalidate" )
		} else {
			@ops_dentry_d_revalidate( $dentry, $flags )
		}
	}
}

probe module( "vfat" ).function( "vfat_revalidate_ci" ) {
	if ( mode == "debug" ) {
		println( "vfat_revalidate_ci" )
	} else {
		if ( mode == "s2e_debug" ) {
			s2e_message( "vfat_revalidate_ci" )
		} else {
			@ops_dentry_d_revalidate( $dentry, $flags )
		}
	}
}

probe module( "vfat" ).function( "vfat_rmdir" ) {
	if ( mode == "debug" ) {
		println( "vfat_rmdir" )
	} else {
		if ( mode == "s2e_debug" ) {
			s2e_message( "vfat_rmdir" )
		} else {
			@ops_inode_rmdir( $dir, $dentry )
		}
	}
}

probe module( "vfat" ).function( "vfat_unlink" ) {
	if ( mode == "debug" ) {
		println( "vfat_unlink" )
	} else {
		if ( mode == "s2e_debug" ) {
			s2e_message( "vfat_unlink" )
		} else {
			@ops_inode_unlink( $dir, $dentry )
		}
	}
}


probe end {
   s2e_kill_state(0, "Branch finished\n")
}

/*
 * inode;getattr=fat_getattr
 * inode;setattr=fat_setattr
 */
